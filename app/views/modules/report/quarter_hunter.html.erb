<style>
	table td,table th {
		text-transform: uppercase;
		padding: 2px 5px !important;
		font-size: 10px !important;
	}
</style>
<script>
	function get_dot_totals(country_id,hunter_id, dot_id){
		var $sum_dot=0
		$(".cell_"+country_id+"_"+hunter_id+"_"+dot_id).each(function(e) {
			$sum_dot+=Number($(this).text());
			// console.log($sum_dot);
		});
		//alert($sum_dot);
		$(".cell_sumary_"+country_id+"_"+hunter_id+"_"+dot_id).html($sum_dot);
	}
</script>
<div class="page-content">
	<div class="page-header position-relative">
		<h1>
			Reporte promediado de Dots <%=@country.country.name%>
			<div class="pull-right">
				<%=form_for :report, :url => modules_reports_quarter_hunter_path, :method=>:get,:class=>"form-inline", html: {id: "form_report"} do |f| %>
					<div style="margin: 0;" class="btn-toolbar">
						<% if current_admin.is_company_admin %>
							<div class="btn-group">
								<div class="input-prepend">
									<span class="add-on">
										<i class="icon-globe"></i>
									</span>
									<%=f.select(:country_id, options_from_collection_for_select(current_admin.company.countries, 'id', 'name', @country.country_id))%>
								</div>
							</div>
						<% end %>
						<!-- <div class="btn-group">
							<div class="input-prepend">
								<span class="add-on">
									<i class="icon-globe"></i>
								</span>
								<%#=f.select(:hunter_id, options_from_collection_for_select(@country.country.talent_hunters, 'id', 'firstname', @country.country_id))%>
							</div>
						</div> -->
						<%=link_to modules_reports_quarter_hunter_path(report: {:country_id=>@country.country_id},format: "xls"), :target=>"_blank", :class=>'btn btn-yellow btn-small"' do%>
							<i class="icon-cloud-download"></i> Excel
						<% end %>
					</div>
				<% end %>
			</div>
		</h1>
	</div>
	<div class="space-6"></div>
	<div class="row-fluid">
		<div class="span12 widget-container-span">
			<div class="widget-box">
				<div class="widget-header widget-header-small header-color-grey">
					<h5 class="bigger">
						<i class="icon-table"></i>
						<%=@work_calendar.country.name %> - Trimestre I
					</h5>
					
				</div>
				<div class="widget-body">
					<div class="widget-body-inner" style="display: block;">
						<div class="widget-main no-padding">
							<table class="table table-bordered table-hover table-condensed" >
								<thead>
					    			<tr>
					    				<th width="150"><i class="icon-user"></i>Talent Hunters</th>
					    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
				    						<th width="60" align="center"><%=hunter.firstname%></th>
					    				<% end %>
					    				<th width="50" class="header-color-grey text-white">Total</th>
					    				<th width="50" class="header-color-grey text-white">Meta</th>
					    				<th width="50" class="header-color-grey text-white">Promedio</th>
					    			</tr>
								</thead>
					    		<tbody>
    				    			<%@country.countries_dots.order("countries_dots.dot_id ASC").each do |dot| %>
    				    			<%total_dot=0%>
    				    			<%goal_dot=0%>
    				    			<tr>
    				    				<td> <%=dot.dot.name%></td>
    				    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
    			    						<% hunter.talent_hunters_dots.order("id ASC").where(:dot_id=>dot.dot_id,work_calendar_id: @work_calendar.id).each do |goal| %>
    			    							<td class="cell_<%=@country.country_id%>_<%=hunter.id%>_<%=goal.dot_id%>">
    			    								<% scored=goal.dots_scoreds.includes(:work_timeframe).where("work_timeframes.is_disabled=false and work_timeframes.quarter=1") %>
    			    								<%=scored.average("total").round%>
    			    								<%total_dot+=scored.average("total").round%>
    			    								<%goal_dot=goal.goal if goal_dot==0%>
    			    							</td>
    			    						<% end %>
    				    				<% end %>
    				    				<td class="header-color-grey text-white"><%=total_dot.round%></td>
    				    				<td class="header-color-grey text-white"><%=goal_dot%></td>
    				    				<td class="header-color-grey text-white"><%=((total_dot.to_f)/@country.country.talent_hunters.for_report.count).round%></td>
    				    			</tr>
    				    				
    				    			<%end %>
					    		</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="space-6"></div>
	<div class="row-fluid">
		<div class="span12 widget-container-span">
			<div class="widget-box">
				<div class="widget-header widget-header-small header-color-grey">
					<h5 class="bigger">
						<i class="icon-table"></i>
						<%=@work_calendar.country.name %> - Trimestre II
					</h5>
					
				</div>
				<div class="widget-body">
					<div class="widget-body-inner" style="display: block;">
						<div class="widget-main no-padding">
							<table class="table table-bordered table-hover table-condensed" >
								<thead>
					    			<tr>
					    				<th width="150"><i class="icon-user"></i>Talent Hunters</th>
					    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
				    						<th width="60" align="center"><%=hunter.firstname%></th>
					    				<% end %>
					    				<th width="50" class="header-color-grey text-white">Total</th>
					    				<th width="50" class="header-color-grey text-white">Meta</th>
					    				<th width="50" class="header-color-grey text-white">Promedio</th>
					    			</tr>
								</thead>
					    		<tbody>
    				    			<%@country.countries_dots.order("countries_dots.dot_id ASC").each do |dot| %>
    				    			<%total_dot=0%>
    				    			<%goal_dot=0%>
    				    			<tr>
    				    				<td> <%=dot.dot.name%></td>
    				    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
    			    						<% hunter.talent_hunters_dots.order("id ASC").where(:dot_id=>dot.dot_id,work_calendar_id: @work_calendar.id).each do |goal| %>
    			    							<td class="cell_<%=@country.country_id%>_<%=hunter.id%>_<%=goal.dot_id%>">
    			    								<% scored=goal.dots_scoreds.includes(:work_timeframe).where("work_timeframes.is_disabled=false and work_timeframes.quarter=2") %>
    			    								<%=scored.average("total").round%>
    			    								<%total_dot+=scored.average("total").round%>
    			    								<%goal_dot=goal.goal if goal_dot==0%>
    			    							</td>
    			    						<% end %>
    				    				<% end %>
    				    				<td class="header-color-grey text-white"><%=total_dot.round%></td>
    				    				<td class="header-color-grey text-white"><%=goal_dot%></td>
    				    				<td class="header-color-grey text-white"><%=((total_dot.to_f)/@country.country.talent_hunters.for_report.count).round%></td>
    				    			</tr>
    				    				
    				    			<%end %>
					    		</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="space-6"></div>
	<div class="row-fluid">
		<div class="span12 widget-container-span">
			<div class="widget-box">
				<div class="widget-header widget-header-small header-color-grey">
					<h5 class="bigger">
						<i class="icon-table"></i>
						<%=@work_calendar.country.name %> - Trimestre III
					</h5>
					
				</div>
				<div class="widget-body">
					<div class="widget-body-inner" style="display: block;">
						<div class="widget-main no-padding">
							<table class="table table-bordered table-hover table-condensed" >
								<thead>
					    			<tr>
					    				<th width="150"><i class="icon-user"></i>Talent Hunters</th>
					    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
				    						<th width="60" align="center"><%=hunter.firstname%></th>
					    				<% end %>
					    				<th width="50" class="header-color-grey text-white">Total</th>
					    				<th width="50" class="header-color-grey text-white">Meta</th>
					    				<th width="50" class="header-color-grey text-white">Promedio</th>
					    			</tr>
								</thead>
					    		<tbody>
    				    			<%@country.countries_dots.order("countries_dots.dot_id ASC").each do |dot| %>
    				    			<%total_dot=0%>
    				    			<%goal_dot=0%>
    				    			<tr>
    				    				<td> <%=dot.dot.name%></td>
    				    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
    			    						<% hunter.talent_hunters_dots.order("id ASC").where(:dot_id=>dot.dot_id,work_calendar_id: @work_calendar.id).each do |goal| %>
    			    							<td class="cell_<%=@country.country_id%>_<%=hunter.id%>_<%=goal.dot_id%>">
    			    								<% scored=goal.dots_scoreds.includes(:work_timeframe).where("work_timeframes.is_disabled=false and work_timeframes.quarter=3") %>
    			    								<%=scored.average("total").round%>
    			    								<%total_dot+=scored.average("total").round%>
    			    								<%goal_dot=goal.goal if goal_dot==0%>
    			    							</td>
    			    						<% end %>
    				    				<% end %>
    				    				<td class="header-color-grey text-white"><%=total_dot.round%></td>
    				    				<td class="header-color-grey text-white"><%=goal_dot%></td>
    				    				<td class="header-color-grey text-white"><%=((total_dot.to_f)/@country.country.talent_hunters.for_report.count).round%></td>
    				    			</tr>
    				    				
    				    			<%end %>
					    		</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="space-6"></div>
	<div class="row-fluid">
		<div class="span12 widget-container-span">
			<div class="widget-box">
				<div class="widget-header widget-header-small header-color-grey">
					<h5 class="bigger">
						<i class="icon-table"></i>
						<%=@work_calendar.country.name %> - Trimestre IV
					</h5>
					
				</div>
				<div class="widget-body">
					<div class="widget-body-inner" style="display: block;">
						<div class="widget-main no-padding">
							<table class="table table-bordered table-hover table-condensed" >
								<thead>
					    			<tr>
					    				<th width="150"><i class="icon-user"></i>Talent Hunters</th>
					    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
				    						<th width="60" align="center"><%=hunter.firstname%></th>
					    				<% end %>
					    				<th width="50" class="header-color-grey text-white">Total</th>
					    				<th width="50" class="header-color-grey text-white">Meta</th>
					    				<th width="50" class="header-color-grey text-white">Promedio</th>
					    			</tr>
								</thead>
					    		<tbody>
    				    			<%@country.countries_dots.order("countries_dots.dot_id ASC").each do |dot| %>
    				    			<%total_dot=0%>
    				    			<%goal_dot=0%>
    				    			<tr>
    				    				<td> <%=dot.dot.name%></td>
    				    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
    			    						<% hunter.talent_hunters_dots.order("id ASC").where(:dot_id=>dot.dot_id,work_calendar_id: @work_calendar.id).each do |goal| %>
    			    							<td class="cell_<%=@country.country_id%>_<%=hunter.id%>_<%=goal.dot_id%>">
    			    								<% scored=goal.dots_scoreds.includes(:work_timeframe).where("work_timeframes.is_disabled=false and work_timeframes.quarter=4") %>
    			    								<%=scored.average("total").round%>
    			    								<%total_dot+=scored.average("total").round%>
    			    								<%goal_dot=goal.goal if goal_dot==0%>
    			    							</td>
    			    						<% end %>
    				    				<% end %>
    				    				<td class="header-color-grey text-white"><%=total_dot.round%></td>
    				    				<td class="header-color-grey text-white"><%=goal_dot%></td>
    				    				<td class="header-color-grey text-white"><%=((total_dot.to_f)/@country.country.talent_hunters.for_report.count).round%></td>
    				    			</tr>
    				    				
    				    			<%end %>
					    		</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	$("#report_month, #report_country_id").on('change',function(event) {
		$form=$("#form_report").submit();
	});
</script>
