<style>
	table td,table th {
		text-transform: uppercase;
		padding: 2px 5px !important;
		font-size: 10px !important;
	}
</style>
<script>
	function get_dot_totals(country_id,hunter_id, dot_id){
		var $sum_dot=0
		$(".cell_"+country_id+"_"+hunter_id+"_"+dot_id).each(function(e) {
			$sum_dot+=Number($(this).text());
			// console.log($sum_dot);
		});
		//alert($sum_dot);
		$(".cell_sumary_"+country_id+"_"+hunter_id+"_"+dot_id).html($sum_dot);
	}
</script>
<div class="page-content">
	<div class="page-header position-relative">
		<h1>
			Dots Mensual <%=MONTHS[@current_month][0]%>
			<div class="pull-right">
				<%=form_for :report, :url => modules_reports_track_path, :method=>:get,:class=>"form-inline", html: {id: "form_report"} do |f| %>
					<div style="margin: 0;" class="btn-toolbar">
						<div class="btn-group">
							<div class="input-prepend">
								<span class="add-on">
									<i class="icon-calendar"></i>
								</span>
								<%=f.select :month, options_for_select(MONTHS,@current_month)%>
							</div>
						</div>
						<% if current_admin.is_company_admin %>
							<div class="btn-group">
								<div class="input-prepend">
									<span class="add-on">
										<i class="icon-globe"></i>
									</span>
									<%=f.select(:country_id, options_from_collection_for_select(current_admin.company.countries, 'id', 'name', @country.country_id))%>
								</div>
							</div>
						<% end %>
						<div class="btn-group">
							<div class="input-prepend">
								<%=link_to modules_reports_track_path(report: {:country_id=>@country.country_id, :month=>@current_month},format: "xls"), :target=>"_blank", :class=>'btn btn-yellow btn-small"' do%>
									<i class="icon-cloud-download"></i> Excel
								<% end %>
							</div>
						</div>
					</div>
				<% end %>
			</div>
		</h1>
	</div>
    <%@current_timeframes.each do |work_timeframe| %>
		<div class="row-fluid">
			<div class="span11 widget-container-span">
				<div class="widget-box">
					<div class="widget-header widget-header-small header-color-grey">
						<h5 class="bigger">
							<i class="icon-table"></i>
							Semana del <%=l work_timeframe.starts_at.to_date, format: :short %> al <%=l work_timeframe.ends_at.to_date, format: :short %>
						</h5>
						
					</div>
					<div class="widget-body">
						<div class="widget-body-inner" style="display: block;">
							<div class="widget-main no-padding">
								<table class="table table-bordered table-hover table-condensed" >
									<thead>
						    			<tr>
						    				<th width="150"><i class="icon-user"></i>Talent Hunters</th>
						    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
					    						<th width="60" align="center"><%=hunter.firstname%></th>
						    				<% end %>
						    				<th width="50" class="header-color-grey text-white">Total</th>
						    			</tr>
									</thead>
						    		<tbody>
	    				    			<%@country.countries_dots.order("countries_dots.dot_id ASC").each do |dot| %>
	    				    			<%total_dot=0%>
	    				    			<%country_goal=0%>
	    								<%country_goal=@country.country.talent_hunters.for_report.first.talent_hunters_dots.where(:dot_id=>dot.dot.id, :work_calendar_id=>@work_calendar.id).first.goal%>
	    				    			<tr>
	    				    				<td> <%=dot.dot.name%></td>
	    				    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
	    			    						<% hunter.talent_hunters_dots.where(:work_calendar_id=>@work_calendar.id).order("id ASC").where(:dot_id=>dot.dot.id).each do |goal| %>
	    			    							<td class="cell_<%=@country.country_id%>_<%=hunter.id%>_<%=goal.dot_id%>">
	    			    								<% scored=goal.dots_scoreds.includes(:work_timeframe)
															.where("work_timeframes.n_number=?",work_timeframe.n_number) %>
	    			    								<!--%=scored.total%-->
														<%= scored.sum("total") %>
	    			    								<%total_dot+=scored.sum("total")%>
	    			    							</td>
	    			    						<% end %>
	    				    				<% end %>
	    				    				<td class="header-color-grey text-white"><%=total_dot%></td>
	    				    			</tr>
	    				    				
	    				    			<%end %>
						    		</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="space-6"></div>
    <% end %>
    <div class="row-fluid">
			<div class="span11 widget-container-span">
				<div class="widget-box">
					<div class="widget-header widget-header-small header-color-red2">
						<h5 class="bigger">
							<i class="icon-table"></i>
							Mes <%=MONTHS[@current_month][0]%>
						</h5>
						
					</div>
					<div class="widget-body">
						<div class="widget-body-inner" style="display: block;">
							<div class="widget-main no-padding">
								<table class="table table-bordered table-hover table-condensed" >
									<thead>
						    			<tr>
						    				<th width="150"><i class="icon-user"></i>Talent Hunters</th>
						    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
					    						<th width="60" align="center"><%=hunter.firstname%></th>
						    				<% end %>
						    				<th width="50" class="header-color-grey text-white">Total</th>
						    			</tr>
									</thead>
						    		<tbody>
	    				    			<%@country.countries_dots.order("countries_dots.dot_id ASC").each do |dot| %>
	    				    			<%total_dot=0%>
	    				    			<%country_goal=0%>
	    								<%country_goal=@country.country.talent_hunters.for_report.first.talent_hunters_dots.where(:dot_id=>dot.dot.id,:work_calendar_id=>@work_calendar.id).first.goal%>
	    				    			<tr class="row_dot_<%=dot.dot_id%>">
	    				    				<td> <%=dot.dot.name%></td>
	    				    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
	    			    						<% hunter.talent_hunters_dots.where(:work_calendar_id=>@work_calendar.id).order("id ASC").where(:dot_id=>dot.dot.id).each do |goal| %>
	    			    							<td class="cell_sumary_<%=@country.country_id%>_<%=hunter.id%>_<%=goal.dot_id%>"> &nbsp;
	    			    							</td>
													<script>
														get_dot_totals(<%=@country.country_id%>,<%=hunter.id%>,<%=goal.dot_id%>);
													</script>
	    			    						<% end %>
	    				    				<% end %>
	    				    				<td class="header-color-grey text-white cell-sumary-total"><%=total_dot%></td>
	    				    			</tr>
	    				    			<script>
	    				    				var $sumary_total=0;
	    				    				$("tr.row_dot_<%=dot.dot_id%> td[class^='cell_sumary']").each(function(e) {
	    				    					$sumary_total+=Number($(this).text());
	    				    				});
	    				    				$("tr.row_dot_<%=dot.dot_id%> td.cell-sumary-total").html($sumary_total);
	    				    			</script>
	    				    			<%end %>
						    		</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>

	<div class="space-6"></div>

	<div class="row-fluid">
		<div class="span11 widget-container-span ui-sortable">
			<table class="table table-bordered table-hover table-condensed" >
				<thead>
	    			<tr>
	    				<th width="150"><i class="icon-user"></i>Talent Hunters</th>
	    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
    						<th width="60" align="center"><%=hunter.firstname%></th>
	    				<% end %>
	    				<th width="50">Total</th>
	    			</tr>
				</thead>
	    		<tbody>
	    			<tr>
	    				<td> No de contrataciones </td>
	    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
    						<td>
								&nbsp;
							</td>
	    				<% end %>
	    				<td> &nbsp;</td>
	    			</tr>
	    			<tr>
	    				<td> Job Orders </td>
	    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
    						<td class="sumary_job_order_<%=hunter.id%>">
							</td>
							<script>
								var $total=0;
								$total=Number($("td.cell_sumary_<%=@country.country_id%>_<%=hunter.id%>_4").text());
								$(".sumary_job_order_<%=hunter.id%>").html($total);
							</script>
	    				<% end %>
	    				<td> &nbsp;</td>
	    			</tr>
	    		</tbody>	
	    		<thead>
		    			<tr class="success">
		    				<th class="header-color-grey text-white"> Efectividad <%=MONTHS[@current_month][0]%> </th>
		    				<%@country.country.talent_hunters.for_report.order("talent_hunters.created_at ASC").each do |hunter| %>
	    						<th class="header-color-grey text-white dot_<%=@country.country_id%>">
									&nbsp;
								</th>
		    				<% end %>
		    				<th class="header-color-grey text-white"> &nbsp;</th>
		    			</tr>
	    		</thead>	    		
			</table>
		</div>
	</div>
	<div class="space-6"></div>
</div>

<script>

	$("#report_month, #report_country_id").on('change',function(event) {
		$form=$("#form_report").submit();
	});
		
</script>