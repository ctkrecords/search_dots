<script src="/assets/js_highchart/highcharts.js"></script>
<script src="/assets/js_highchart/modules/exporting.js"></script>
<style>
	table td,table th {
		text-transform: uppercase;
		padding: 2px 5px !important;
		font-size: 10px !important;
	}
</style>
<div class="page-content">
	<div class="page-header position-relative">
		<h1>
			Dashboard
			<small>
				<i class="icon-double-angle-right"></i>
				Talent Hunter
			</small>
		</h1>
	</div><!--/.page-header-->

	<div class="row-fluid">
		<div class="span12">
			<%= render "partials/notices" %>

			<div class="row-fluid">
<!-- 				<div class="span6 infobox-container hidden">

					<div class="infobox infobox-orange infobox infobox-dark">
						<div class="infobox-icon">
							<i class="icon-download-alt"></i>
						</div>

						<div class="infobox-data">
							<div class="infobox-content">Billing Semana</div>
							<div class="infobox-content">$4,000</div>
						</div>
					</div>

					<div class="infobox infobox-grey infobox infobox-dark">
						<div class="infobox-progress">
							<div class="easy-pie-chart percentage" data-percent="25" data-size="46">
								<span class="percent">25</span>
								%
							</div>
						</div>

						<div class="infobox-data">
							<span class="infobox-content">Meta Semana</span>
							<div class="infobox-content">$ 120,000 </div>
						</div>
					</div>

					<div class="space-6"></div>

					<div class="infobox infobox-blue2 infobox infobox-dark">
						<div class="infobox-icon">
							<i class="icon-download-alt"></i>
						</div>

						<div class="infobox-data">
							<div class="infobox-content">Billing Mes</div>
							<div class="infobox-content">$32,000</div>
						</div>
					</div>

					<div class="infobox infobox-blue infobox infobox-dark">
						<div class="infobox-progress">
							<div class="easy-pie-chart percentage" data-percent="42" data-size="46">
								<span class="percent">42</span>
								%
							</div>
						</div>

						<div class="infobox-data">
							<span class="infobox-content">Meta Mes</span>
							<div class="infobox-content">$ 15,000 </div>
						</div>
					</div>

					<div class="space-6"></div>

					<div class="infobox infobox-green2 infobox infobox-dark">
						<div class="infobox-icon">
							<i class="icon-download-alt"></i>
						</div>

						<div class="infobox-data">
							<div class="infobox-content">Billing Acum.</div>
							<div class="infobox-content">$123,000</div>
						</div>
					</div>

					<div class="infobox infobox-green infobox infobox-dark">
						<div class="infobox-progress">
							<div class="easy-pie-chart percentage" data-percent="90" data-size="46">
								<span class="percent">90</span>
								%
							</div>
						</div>

						<div class="infobox-data">
							<span class="infobox-content">Meta Acu.</span>
							<div class="infobox-content">$ 120,000 </div>
						</div>
					</div>

					<div class="space-6"></div>

					<div class="infobox infobox-pink  ">
						<div class="infobox-chart">
							<span class="sparkline" data-values="196,128,202,177,154,94,100,170,224"></span>
						</div>

						<div class="infobox-data">
							<span class="infobox-data-number">6,251</span>
							<div class="infobox-content">Job Orders</div>
						</div>

						<div class="badge badge-success">
							7.2%
							<i class="icon-arrow-up"></i>
						</div>
					</div>

					<div class="infobox infobox-blue  ">
						<div class="infobox-icon">
							<i class="icon-suitcase"></i>
						</div>

						<div class="infobox-data">
							<span class="infobox-data-number">11</span>
							<div class="infobox-content">Colocados Reales</div>
						</div>

						<div class="badge badge-success">
							+32%
							<i class="icon-arrow-up"></i>
						</div>
					</div>
				</div>

				<div class="vspace"></div> 
 -->
				<div class="span12">
					<div class="widget-box">
						<div class="widget-header widget-header-flat widget-header-small">
							<h5><i class="icon-signal"></i>Cumplimiento de Dots</h5>
							<div class="widget-toolbar no-border">
								<ul id="myTab" class="nav nav-tabs">
									<li class="active"><a href="#week_tab" data-toggle="tab">Semana</a></li>
									<li><a href="#month_tab" data-toggle="tab">Mes</a></li>
									<li><a href="#quarter_tab" data-toggle="tab">Trimestre <%=@current_timeframe.quarter%></a></li>
									<li><a href="#year_tab" data-toggle="tab">AÃ±o</a></li>
								</ul>
							</div>
						</div>

						<div class="widget-body">
							<div class="widget-main">
								<div class="tab-content">
									<div id="week_tab" class="tab-pane active">
										<div id="barchart-week"></div>
									</div>
									<div id="month_tab" class="tab-pane">
										<div id="barchart-month"></div>
									</div>
									<div id="quarter_tab" class="tab-pane">
										<div id="barchart-quarter"></div>
									</div>
									<div id="year_tab" class="tab-pane">
										<div id="barchart-year"></div>
									</div>
								</div>
							</div><!--/widget-main-->
						</div><!--/widget-body-->
					</div><!--/widget-box-->
				</div><!--/span-->
			</div><!--/row-->

			<div class="hr hr32 hr-dotted"></div>
			<div class="row-fluid">
				<div class="span12"><br></div>
			</div>
			<!-- Tabla de Datos de la Semana -->
			<div class="row-fluid">
				<div class="span12">
					<div class="widget-box">
						<div class="widget-header widget-header-flat widget-header-small header-color-grey">
							<h4 class="lighter">
								<i class="icon-flickr"></i>
								Resultados Dots <%=MONTHS[DateTime.now.month][0]%>
							</h4>
						</div>

						<div class="widget-body">
							<div class="widget-main no-padding">
								<table class="table table-bordered table-hover table-condensed" >
									<thead>
										<tr >
											<th class="header-color-grey text-white">Semanas</th>
											<% @talent_hunters_dots.each do |goal| %>
												<th><span style="font-size:10px "> <%=goal.dot.name%></span></th>
											<% end %>
										</tr>
									</thead>
									<tbody>
	        						<% timesframes_chart=@work_calendar.work_timeframes.where("month = ?", DateTime.now.month)%>
	        							<%timesframes_chart.order("n_number DESC").each do |timef|%>
										<tr>
											<td class="header-color-grey text-white">
												<span title="" data-placement="right" data-rel="tooltip" class="btn-small tooltip-primary" data-original-title="Semana <%= timef.n_number%>"><%=l timef.starts_at, format: :short %> al <%=l timef.ends_at, format: :short  %></span>

											</td>
											<% @talent_hunters_dots.each do |goal| %>
												<% goal.dots_scoreds.where(:work_timeframe_id=>timef.id).each do |scored| %>
												<% if scored.total < scored.talent_hunters_dot.goal 
													dot_class="red"
												   elsif scored.total== scored.talent_hunters_dot.goal 
												   	dot_class="yellow2"
												   else
													dot_class="green"
												   end
												%>
												<td class="center">
													<span class="badge badge-<%=dot_class%>">
														<%=scored.total%>
													</span>
												</td>
												<% end %>
											<% end %>
										</tr>
										<% end %>
										<tr>
											<th class="header-color-grey text-white">
												Total
											</th>
											<% @talent_hunters_dots.order("dot_id asc").each do |goal| %>
												<% scored=goal.dots_scoreds.where(:work_timeframe_id=>@selected_timeframes.map(&:id)) %>
												<th class="center">
													<span class="badge badge-info">
														<%=scored.sum("total")%>
													</span>
												</th>
											<% end %>
										</tr>
										<tr>
											<th class="header-color-grey text-white">
												Meta
											</th>
											<% @talent_hunters_dots.order("dot_id asc").each do |goal| %>
												
												<th class="center">
													<span class="badge badge-info">
														<%=goal.goal*@selected_timeframes.count%>
													</span>
												</th>
											<% end %>
										</tr>
										<tr>
											<th class="header-color-grey text-white">
												+ / -
											</th>
											<% @talent_hunters_dots.order("dot_id asc").each do |goal| %>
												<% scored=goal.dots_scoreds.where(:work_timeframe_id=>@selected_timeframes.map(&:id)) %>
												<% f_total=(scored.sum("total")-(goal.goal*@selected_timeframes.count))%>
												<th class="center">
													<span class="badge badge-purple">
														<%= "+" if f_total > 0%><%=f_total%>
													</span>
												</th>
											<% end %>
										</tr>
									</tbody>
								</table>
							</div><!--/widget-main-->
						</div><!--/widget-body-->
					</div><!--/widget-box-->
				</div>
			</div>	
			<div class="row-fluid"><br></div>
		</div>
	</div>

<script type="text/javascript">
$('[data-rel=tooltip]').tooltip();
$(function() {
	
	$('.easy-pie-chart.percentage').each(function(){
		var $box = $(this).closest('.infobox');
		var barColor = $(this).data('color') || (!$box.hasClass('infobox-dark') ? $box.css('color') : 'rgba(255,255,255,0.95)');
		var trackColor = barColor == 'rgba(255,255,255,0.95)' ? 'rgba(255,255,255,0.25)' : '#E2E2E2';
		var size = parseInt($(this).data('size')) || 50;
		$(this).easyPieChart({
			barColor: barColor,
			trackColor: trackColor,
			scaleColor: false,
			lineCap: 'butt',
			lineWidth: parseInt(size/10),
			animate: /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase()) ? false : 1000,
			size: size
		});
	})
	
	$('.sparkline').each(function(){
		var $box = $(this).closest('.infobox');
		var barColor = !$box.hasClass('infobox-dark') ? $box.css('color') : '#FFF';
		$(this).sparkline('html', {tagValuesAttribute:'data-values', type: 'bar', barColor: barColor , chartRangeMin:$(this).data('min') || 0} );
	});

		// HIGHCHART
		$('#barchart-week').highcharts({
		    chart: {
		        type: 'column',
		        height: 250
		    },
		    credits: {
		    	enabled: false,
		    },
		    title: {
		        text: ''
		    },
		    subtitle: {
		        
		    },
		    xAxis: {
		        categories: [
		        	<% @talent_hunters_dots.each do |goal| %>
		        	'<%=goal.dot.name%>',
		        	<% end %>
		        ]
		    },
		    yAxis: {
		        min: 0,
		        title: {
		            text: ''
		        }
		    },
		    tooltip: {
		        headerFormat: "<span class='label label-warning arrowed-right arrowed-in-left'>{point.key}</span><table>",
		        pointFormat: "<tr><td style='color:{series.color};padding:0'>{series.name}:</td>" +
		            '<td style="padding:0"><b>{point.y}</b></td></tr>',
		        footerFormat: '</table>',
		        shared: true,
		        useHTML: true
		    },
		    plotOptions: {
		        column: {
		            pointPadding: 0.2,
		            borderWidth: 0,
		            dataLabels: {
	                	enabled: true,
	                	formatter: function () {
	                		return this.y;
	                	}
	                }
		        }
		    },

		    series: [
		    
		    {
		    	name: 'Real',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       		<% goal.dots_scoreds.where(:work_timeframe_id=>@current_timeframe.id).each do |scored| %>
		       			<%=scored.total%>,
		       		<% end %>
		       	<% end %>
	        	], color: '#5479FF'
			},
	        
		    {
		    	name: 'Meta',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       			<%=goal.goal%>,
		       	<% end %>
	        	], color: '#ccc'
			},
		    ]
		});

		$('#barchart-month').highcharts({
		    chart: {
		        type: 'column',
		        height: 250
		    },
		    credits: {
		    	enabled: false,
		    },
		    title: {
		        text: ''
		    },
		    subtitle: {
		        
		    },
		    xAxis: {
		        categories: [
		        	<% @talent_hunters_dots.each do |goal| %>
		        	'<%=goal.dot.name%>',
		        	<% end %>
		        ]
		    },
		    yAxis: {
		        min: 0,
		        title: {
		            text: ''
		        }
		    },
		    tooltip: {
		        headerFormat: "<span class='label label-warning arrowed-right arrowed-in-left'>{point.key}</span><table>",
		        pointFormat: "<tr><td style='color:{series.color};padding:0'>{series.name}:</td>" +
		            '<td style="padding:0"><b>{point.y}</b></td></tr>',
		        footerFormat: '</table>',
		        shared: true,
		        useHTML: true
		    },
		    plotOptions: {
		        column: {
		            pointPadding: 0.2,
		            borderWidth: 0,
		            dataLabels: {
	                	enabled: true,
	                	formatter: function () {
	                		return this.y;
	                	}
	                }
		        }
		    },

		    series: [
		    
		    {
		    	name: 'Real',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       		<%=scored=goal.dots_scoreds.joins(:work_timeframe).where("work_timeframes.month= ?", DateTime.now.month).sum("total") %>,
	       			<%#=scored.sum("total")%>
		       	<% end %>
	        	], color: '#5479FF'
			},
	        
		    {
		    	name: 'Meta',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       			<%=(goal.goal)*@selected_timeframes.where("month = ?",DateTime.now.month).count%>,
		       	<% end %>
	        	], color: '#ccc'
			},
		    ]
		});
		
		$('#barchart-quarter').highcharts({
		    chart: {
		        type: 'column',
		        height: 250
		    },
		    credits: {
		    	enabled: false,
		    },
		    title: {
		        text: ''
		    },
		    subtitle: {
		        
		    },
		    xAxis: {
		        categories: [
		        	<% @talent_hunters_dots.each do |goal| %>
		        	'<%=goal.dot.name%>',
		        	<% end %>
		        ]
		    },
		    yAxis: {
		        min: 0,
		        title: {
		            text: ''
		        }
		    },
		    tooltip: {
		        headerFormat: "<span class='label label-warning arrowed-right arrowed-in-left'>{point.key}</span><table>",
		        pointFormat: "<tr><td style='color:{series.color};padding:0'>{series.name}:</td>" +
		            '<td style="padding:0"><b>{point.y}</b></td></tr>',
		        footerFormat: '</table>',
		        shared: true,
		        useHTML: true
		    },
		    plotOptions: {
		        column: {
		            pointPadding: 0.2,
		            borderWidth: 0,
		            dataLabels: {
	                	enabled: true,
	                	formatter: function () {
	                		return this.y;
	                	}
	                }
		        }
		    },

		    series: [
		    
		    {
		    	name: 'Real',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       		<% scored=goal.dots_scoreds.includes(:work_timeframe).where("work_timeframes.quarter=#{@current_timeframe.quarter}") %>
	       			<%=scored.sum("total")%>,
		       	<% end %>
	        	], color: '#5479FF'
			},
	        
		    {
		    	name: 'Meta',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       			<%=(goal.goal)*@work_calendar.work_timeframes.active.where("quarter = ?",@current_timeframe.quarter).count%>,
		       	<% end %>
	        	], color: '#ccc'
			},
		    ]
		});

		$('#barchart-year').highcharts({
		    chart: {
		        type: 'column',
		        height: 250
		    },
		    credits: {
		    	enabled: false,
		    },
		    title: {
		        text: ''
		    },
		    subtitle: {
		        
		    },
		    xAxis: {
		        categories: [
		        	<% @talent_hunters_dots.each do |goal| %>
		        	'<%=goal.dot.name%>',
		        	<% end %>
		        ]
		    },
		    yAxis: {
		        min: 0,
		        title: {
		            text: ''
		        }
		    },
		    tooltip: {
		        headerFormat: "<span class='label label-warning arrowed-right arrowed-in-left'>{point.key}</span><table>",
		        pointFormat: "<tr><td style='color:{series.color};padding:0'>{series.name}:</td>" +
		            '<td style="padding:0"><b>{point.y}</b></td></tr>',
		        footerFormat: '</table>',
		        shared: true,
		        useHTML: true
		    },
		    plotOptions: {
		        column: {
		            pointPadding: 0.2,
		            borderWidth: 0,
		            dataLabels: {
	                	enabled: true,
	                	formatter: function () {
	                		return this.y;
	                	}
	                }
		        }
		    },

		    series: [
		    
		    {
		    	name: 'Real',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       		<% scored=goal.dots_scoreds.includes(:work_timeframe).where("work_timeframes.work_calendar_id=?",@work_calendar.id) %>
	       			<%=scored.sum("total")%>,
		       	<% end %>
	        	], color: '#5479FF'
			},
	        
		    {
		    	name: 'Meta',
		    	data:[
		    	<% @talent_hunters_dots.each do |goal| %>
		       			<%=(goal.goal)*@work_calendar.work_timeframes.active.count%>,
		       	<% end %>
	        	], color: '#ccc'
			},
		    ]
		});

  });
</script>